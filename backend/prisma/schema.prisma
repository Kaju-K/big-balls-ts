generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id             Int           @id @default(autoincrement())
  username       String        @unique @db.VarChar(30)
  email          String        @unique
  createdAt      DateTime      @default(now())
  password       String
  chearingTeam   Team?         @relation("ChearingTeam", fields: [chearingteamId], references: [id])
  chearingteamId Int?
  Group          Group[]
  Participant    Participant[]
  isValidated    Boolean       @default(false)

  @@map("users")
}

model Team {
  id           Int           @id @default(autoincrement())
  name         String
  logo         String
  ChearingUser User[]        @relation("ChearingTeam")
  Participant  Participant[]
  hostGames    Game[]        @relation("HostTeam")
  visitorGames Game[]        @relation("VisitorTeam")

  @@map("teams")
}

model Group {
  id               Int           @id @default(autoincrement())
  User             User          @relation(fields: [ownerId], references: [id])
  ownerId          Int
  Participant      Participant[]
  name             String        @db.VarChar(30)
  dateCreated      DateTime      @default(now())
  coverImage       String?
  description      String?       @db.VarChar(200)
  rule             String        @default("normal") // check better naming
  GroupGame        GroupGame[]
  private          Boolean       @default(true)
  isPasswordNeeded Boolean?
  password         String
  League           League        @relation(fields: [leagueId], references: [id])
  leagueId         Int

  @@map("groups")
}

model Participant {
  id           Int      @id @default(autoincrement())
  User         User     @relation(fields: [userId], references: [id])
  userId       Int
  Group        Group    @relation(fields: [groupId], references: [id])
  groupId      Int
  dateEntrance DateTime @default(now())
  points       Int      @default(0)
  Team         Team[]
  Bet          Bet[]
  isActive     Boolean  @default(true)

  @@unique([userId, groupId])
  @@map("participants")
}

model GroupGame {
  id           Int     @id @default(autoincrement())
  Bet          Bet[]
  Group        Group   @relation(fields: [groupId], references: [id])
  groupId      Int
  Game         Game    @relation(fields: [gameId], references: [id])
  gameId       Int
  isOpenForBet Boolean @default(true)

  @@map("group_games")
}

model Bet {
  id            Int         @id @default(autoincrement())
  isBetCorrect  Boolean?
  dateCreated   DateTime    @default(now())
  GroupGame     GroupGame   @relation(fields: [groupGameId], references: [id])
  groupGameId   Int
  Participant   Participant @relation(fields: [participantId], references: [id])
  participantId Int
  betAmount     Int

  @@map("bets")
}

model Game {
  id            Int               @id @default(autoincrement())
  GroupGame     GroupGame[]
  dateGame      DateTime
  hostTeam      Team              @relation("HostTeam", fields: [hostTeamId], references: [id])
  visitorTeam   Team              @relation("VisitorTeam", fields: [visitorTeamId], references: [id])
  hostTeamId    Int
  visitorTeamId Int
  winner        StatusGameResult? @default(null)
  hostScore     Int?
  visitorScore  Int?

  @@map("games")
}

model League {
  id         Int       @id @default(autoincrement())
  name       String
  dateStart  DateTime
  dateFinish DateTime?
  Round      Round[]
  Group      Group[]

  @@map("leagues")
}

model Round {
  id          Int    @id @default(autoincrement())
  League      League @relation(fields: [leagueId], references: [id])
  leagueId    Int
  roundNumber Int

  @@map("rounds")
}

enum StatusGameResult {
  HOST
  VISITOR
  DRAW
  CANCELED
  null
}
